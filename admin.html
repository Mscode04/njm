<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <style>
        .tab-content {
            padding: 20px;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            border-radius: 0 0 5px 5px;
        }
        .nav-tabs {
            margin-bottom: 0;
        }
        .card {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Admin Dashboard</h1>
        
        <ul class="nav nav-tabs" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="feedback-tab" data-bs-toggle="tab" data-bs-target="#feedback" type="button" role="tab">Feedback</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="news-tab" data-bs-toggle="tab" data-bs-target="#news" type="button" role="tab">News</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="view-tab" data-bs-toggle="tab" data-bs-target="#view" type="button" role="tab">View Data</button>
            </li>
        </ul>
        
        <div class="tab-content" id="adminTabsContent">
            <!-- Feedback Tab -->
            <div class="tab-pane fade show active" id="feedback" role="tabpanel">
                <h3>Add Feedback</h3>
                <form id="feedbackForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="designation" class="form-label">Designation</label>
                        <input type="text" class="form-control" id="designation" required>
                    </div>
                    <div class="mb-3">
                        <label for="feedbackDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="feedbackDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="feedbackText" class="form-label">Feedback</label>
                        <textarea class="form-control" id="feedbackText" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Feedback</button>
                </form>
                <div id="feedbackSuccess" class="alert alert-success mt-3" style="display:none;"></div>
                <div id="feedbackError" class="alert alert-danger mt-3" style="display:none;"></div>
            </div>
            
            <!-- News Tab -->
            <div class="tab-pane fade" id="news" role="tabpanel">
                <h3>Add News</h3>
                <form id="newsForm">
                    <div class="mb-3">
                        <label for="newsDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="newsDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="newsText" class="form-label">News Content</label>
                        <textarea class="form-control" id="newsText" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="validFrom" class="form-label">Valid From</label>
                        <input type="date" class="form-control" id="validFrom" required>
                    </div>
                    <div class="mb-3">
                        <label for="validTill" class="form-label">Valid Till</label>
                        <input type="date" class="form-control" id="validTill" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add News</button>
                </form>
                <div id="newsSuccess" class="alert alert-success mt-3" style="display:none;"></div>
                <div id="newsError" class="alert alert-danger mt-3" style="display:none;"></div>
            </div>
            
            <!-- View Data Tab -->
            <div class="tab-pane fade" id="view" role="tabpanel">
                <h3>View Data</h3>
                <div class="row">
                    <div class="col-md-6">
                        <h4>Feedback</h4>
                        <div id="feedbackList"></div>
                    </div>
                    <div class="col-md-6">
                        <h4>News</h4>
                        <div id="newsList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCxPIrwvFUU-2Cayh_C_ROC6ipRU_tqU9U",
            authDomain: "palliative-app-10572.firebaseapp.com",
            projectId: "palliative-app-10572",
            storageBucket: "palliative-app-10572.appspot.com",
            messagingSenderId: "881815533939",
            appId: "1:881815533939:web:c4d123ef491a87d0966d06",
            measurementId: "G-633L797DCK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Feedback Form Submission
        document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const designation = document.getElementById('designation').value;
            const date = document.getElementById('feedbackDate').value;
            const feedback = document.getElementById('feedbackText').value;
            
            try {
                await db.collection('FeedBacks').add({
                    name: name,
                    designation: designation,
                    date: date,
                    feedback: feedback,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                document.getElementById('feedbackSuccess').textContent = 'Feedback submitted successfully!';
                document.getElementById('feedbackSuccess').style.display = 'block';
                document.getElementById('feedbackError').style.display = 'none';
                document.getElementById('feedbackForm').reset();
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    document.getElementById('feedbackSuccess').style.display = 'none';
                }, 3000);
            } catch (error) {
                document.getElementById('feedbackError').textContent = 'Error submitting feedback: ' + error.message;
                document.getElementById('feedbackError').style.display = 'block';
                document.getElementById('feedbackSuccess').style.display = 'none';
            }
        });

        // News Form Submission
        document.getElementById('newsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const date = document.getElementById('newsDate').value;
            const news = document.getElementById('newsText').value;
            const validFrom = document.getElementById('validFrom').value;
            const validTill = document.getElementById('validTill').value;
            
            try {
                await db.collection('News').add({
                    date: date,
                    news: news,
                    validFrom: validFrom,
                    validTill: validTill,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                document.getElementById('newsSuccess').textContent = 'News added successfully!';
                document.getElementById('newsSuccess').style.display = 'block';
                document.getElementById('newsError').style.display = 'none';
                document.getElementById('newsForm').reset();
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    document.getElementById('newsSuccess').style.display = 'none';
                }, 3000);
            } catch (error) {
                document.getElementById('newsError').textContent = 'Error adding news: ' + error.message;
                document.getElementById('newsError').style.display = 'block';
                document.getElementById('newsSuccess').style.display = 'none';
            }
        });

        // Load data for View tab
        function loadData() {
            // Load feedback
            db.collection('FeedBacks').orderBy('timestamp', 'desc').get().then((querySnapshot) => {
                const feedbackList = document.getElementById('feedbackList');
                feedbackList.innerHTML = '';
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    feedbackList.innerHTML += `
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${data.name} - ${data.designation}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${data.date}</h6>
                                <p class="card-text">${data.feedback}</p>
                            </div>
                        </div>
                    `;
                });
                
                if (querySnapshot.empty) {
                    feedbackList.innerHTML = '<p>No feedback found.</p>';
                }
            });
            
            // Load news
            db.collection('News').orderBy('timestamp', 'desc').get().then((querySnapshot) => {
                const newsList = document.getElementById('newsList');
                newsList.innerHTML = '';
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    newsList.innerHTML += `
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${data.date}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">Valid: ${data.validFrom} to ${data.validTill}</h6>
                                <p class="card-text">${data.news}</p>
                            </div>
                        </div>
                    `;
                });
                
                if (querySnapshot.empty) {
                    newsList.innerHTML = '<p>No news found.</p>';
                }
            });
        }

        // Load data when View tab is clicked
        document.getElementById('view-tab').addEventListener('click', loadData);

        // Set today's date as default for date fields
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('feedbackDate').value = today;
            document.getElementById('newsDate').value = today;
            document.getElementById('validFrom').value = today;
            
            // Set validTill to 7 days from today by default
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('validTill').value = nextWeek.toISOString().split('T')[0];
        });
    </script>
</body>
</html>